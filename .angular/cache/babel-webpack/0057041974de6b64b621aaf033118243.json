{"ast":null,"code":"import { FormGroup, FormControl } from '@angular/forms';\nimport axios from 'axios';\nimport { BarcodeScannerLivestreamComponent } from 'ngx-barcode-scanner';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./../../service/login.service\";\nimport * as i2 from \"ngx-spinner\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../sidebar/sidebar.component\";\nimport * as i5 from \"../header/header.component\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@angular/common\";\nimport * as i8 from \"../footer/footer.component\";\n\nfunction FardashboardComponent_option_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", item_r3.fmcode_b1, \" \", item_r3.fmname, \"\");\n  }\n}\n\nfunction FardashboardComponent_option_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r4 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate2(\"\", item_r4.TRUCK_NO, \" \", item_r4.REGTRUCK, \"\");\n  }\n}\n\nfunction FardashboardComponent_table_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 30);\n    i0.ɵɵelementStart(1, \"tr\");\n    i0.ɵɵelementStart(2, \"td\");\n    i0.ɵɵtext(3, \" \\u0E43\\u0E1A\\u0E04\\u0E34\\u0E27\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"tr\");\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8, \" \\u0E40\\u0E08\\u0E49\\u0E32\\u0E02\\u0E2D\\u0E07\\u0E2D\\u0E49\\u0E2D\\u0E22\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"tr\");\n    i0.ɵɵelement(12, \"td\");\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", item_r5.truck_q, \" \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\"\", item_r5.fmname, \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", item_r5.f, \" \");\n  }\n}\n\nexport let FardashboardComponent = /*#__PURE__*/(() => {\n  class FardashboardComponent {\n    constructor(userlogin, spinner, router) {\n      this.userlogin = userlogin;\n      this.spinner = spinner;\n      this.router = router;\n      this.barcodeScanner = new BarcodeScannerLivestreamComponent();\n      this.barcode_type = \"code_128\";\n      this.userdata = this.userlogin.Loadlocal();\n\n      if (this.userdata == null || this.userdata == undefined || this.userdata == []) {\n        this.router.navigateByUrl(\"/login\");\n      }\n\n      this.FormOne = new FormGroup({\n        zeroqrcodedata: new FormControl(),\n        onefmcode: new FormControl(),\n        twotruckreg: new FormControl()\n      });\n    }\n\n    ngOnInit() {\n      this.Loadfarmer21();\n      this.LoadTruckdata();\n      this.LoadsortQueue();\n    }\n\n    OpenBarcodeScan() {\n      this.barcodeScanner.start();\n    }\n\n    CloseBarcodeScan() {\n      this.barcodeScanner.stop();\n    }\n\n    onValueChanges(result) {\n      this.barcodeValue = result.codeResult.code;\n      this.barcode = result.codeResult.code;\n      this.Loadqonline(this.barcode);\n    }\n\n    onStarted(started) {\n      console.log(started);\n    }\n\n    Loadfarmer21() {\n      axios.get(\"https://asia-southeast2-brr-farmluck.cloudfunctions.net/dbcps/v_farmer_basic_w?supzone='21'\").then(res => {\n        this.farmerzone21 = res.data.recordset;\n      }).catch(err => {\n        throw err;\n      });\n    }\n\n    Loadqonline(code) {\n      var _a;\n\n      let barcode = (_a = this.FormOne.get(\"zeroqrcodedata\")) === null || _a === void 0 ? void 0 : _a.value;\n      axios.get(\"https://asia-southeast2-brr-farmluck.cloudfunctions.net/app_farmer/v_Printcard_w?truck_q='\" + barcode + \"'\").then(res => {\n        var _a;\n\n        this.farqrdata = res.data.recordset;\n        (_a = this.FormOne.get('onefmcode')) === null || _a === void 0 ? void 0 : _a.setValue(this.farqrdata[0].fmcode);\n        console.log(this.farqrdata);\n      }).catch(err => {\n        throw err;\n      });\n      this.LoadsortQueue();\n    }\n\n    onKey(event) {\n      this.barcode = event.target.value;\n    }\n\n    LoadTruckdata() {\n      let url = \"https://asia-southeast2-brr-farmluck.cloudfunctions.net/app_farmer/select_v_Truck_w?f12=1\";\n      axios.get(url).then(res => {\n        this.truckdata = res.data.recordset;\n      }).catch(err => {\n        throw err;\n      });\n    } // แก้ไขคิวอัพเดทคิวอ้อยทางไกล\n\n\n    UpdateQueue() {\n      var _a, _b;\n\n      this.LoadsortQueue();\n      let fmcode = ((_a = this.FormOne.get('onefmcode')) === null || _a === void 0 ? void 0 : _a.value).slice(0, 10);\n      let regtruck = ((_b = this.FormOne.get('twotruckreg')) === null || _b === void 0 ? void 0 : _b.value).slice(0, 10);\n\n      if (fmcode == '' || fmcode == undefined || fmcode == null) {\n        alert(\"กรุณาเลือกชาวไร่ หรือ ระบุโควต้า\");\n      } else if (regtruck == '' || regtruck == undefined || regtruck == null) {\n        alert(\"กรุณาเลือกทะเบียนรถ หรือ ระบุทะเบียนรถ\");\n      } else {\n        let url = \"https://asia-southeast2-brr-farmluck.cloudfunctions.net/app_farmer/update_qcard_in_q_v4?q_id=\" + (this.forwardqrun + 1) + \"&fmcode=\" + fmcode + \"&truck_no=\" + regtruck + \"&print_q=2\" + \"&userlogin='\" + this.userdata[0].supcode + \"'\" + \"&truck_q=\" + this.barcode;\n        console.log(url);\n\n        if (confirm('ต้องการบันทึกรายการ หรือไม่ ?') == true) {\n          axios.post(url).then(res => {\n            if (res.data.rowsAffected[0] == 1) {\n              this.SendsortQueue();\n              alert(\"บันทึกข้อมูลคิวแล้ว\");\n              $('#showqueue').modal('show');\n              this.FormOne.reset();\n              this.farqrdata = null;\n            } else if (res.data.rowsAffected[0] == 0) {\n              alert(\"!!กรุณาลองใหม่ บันทึกรายการไม่สำเร็จ!!\");\n            } else if (res.data.code) {\n              alert(\"!!กรุณาลองใหม่ บันทึกรายการไม่สำเร็จ!!\");\n            }\n          }).catch(err => {\n            throw err;\n          });\n        } else {\n          alert(\"ยกเลิกรายการแล้ว\");\n          this.FormOne.reset();\n        }\n      }\n    }\n\n    LoadsortQueue() {\n      axios.get(\"https://asia-southeast2-brr-farmluck.cloudfunctions.net/app_farmer/select_qonline\").then(res => {\n        this.spinner.show();\n        let data = res.data.recordset;\n        this.forwardqrun = data[0].qf2_run;\n        this.spinner.hide();\n      }).catch(err => {\n        throw err;\n      });\n    } // ส่งลำดับคิว \n\n\n    SendsortQueue() {\n      let nextque = this.forwardqrun + 1;\n      let url = \"https://asia-southeast2-brr-farmluck.cloudfunctions.net/app_farmer/update_qonline_w?qf2_run=\" + nextque + \"&timechange=getdate();\"; // console.log(url);\n\n      axios.post(url).then(res => {\n        if (res.data.rowsAffected[0] == 1) {\n          console.log(\"q update\"); // this.LoadsortQueue();\n        } else {\n          console.log(\"q don't update\");\n        }\n      }).catch(err => {\n        throw err;\n      });\n    }\n\n    ngOnDestroy() {\n      //Called once, before the instance is destroyed.\n      //Add 'implements OnDestroy' to the class.\n      this.farmerzone21 = null;\n      this.farqrdata = null;\n    }\n\n  }\n\n  FardashboardComponent.ɵfac = function FardashboardComponent_Factory(t) {\n    return new (t || FardashboardComponent)(i0.ɵɵdirectiveInject(i1.LoginService), i0.ɵɵdirectiveInject(i2.NgxSpinnerService), i0.ɵɵdirectiveInject(i3.Router));\n  };\n\n  FardashboardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: FardashboardComponent,\n    selectors: [[\"app-fardashboard\"]],\n    viewQuery: function FardashboardComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(BarcodeScannerLivestreamComponent, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.barcodeScanner = _t.first);\n      }\n    },\n    decls: 50,\n    vars: 7,\n    consts: [[\"bdColor\", \"rgba(0, 0, 0, 0.8)\", \"size\", \"medium\", \"color\", \"#fff\", \"type\", \"square-jelly-box\", 3, \"fullScreen\"], [2, \"color\", \"white\"], [1, \"wrapper\"], [1, \"main-panel\"], [1, \"content\"], [1, \"container-fluid\"], [1, \"card\"], [1, \"card-body\"], [3, \"formGroup\"], [1, \"input-group\", \"mb-3\"], [\"id\", \"basic-addon1\", 1, \"input-group-text\"], [\"type\", \"text\", \"formControlName\", \"zeroqrcodedata\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [1, \"input-group-text\"], [\"type\", \"text\", \"list\", \"farmer21\", \"formControlName\", \"onefmcode\", 1, \"form-control\"], [\"id\", \"farmer21\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"text\", \"formControlName\", \"twotruckreg\", \"list\", \"Truckdata\", 1, \"form-control\"], [\"id\", \"Truckdata\"], [1, \"btn\", \"btn-info\", 3, \"click\"], [\"class\", \"table\", 4, \"ngFor\", \"ngForOf\"], [\"id\", \"showqueue\", \"tabindex\", \"-1\", \"role\", \"dialog\", \"aria-labelledby\", \"exampleModalScrollableTitle\", \"aria-hidden\", \"true\", 1, \"modal\", \"fade\"], [\"role\", \"document\", 1, \"modal-dialog\", \"modal-dialog-scrollable\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"exampleModalScrollableTitle\", 1, \"modal-title\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"close\"], [\"aria-hidden\", \"true\"], [1, \"modal-body\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\"], [1, \"table\"]],\n    template: function FardashboardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ngx-spinner\", 0);\n        i0.ɵɵelementStart(1, \"p\", 1);\n        i0.ɵɵtext(2, \" Loading... \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"div\", 2);\n        i0.ɵɵelement(4, \"app-sidebar\");\n        i0.ɵɵelementStart(5, \"div\", 3);\n        i0.ɵɵelement(6, \"app-header\");\n        i0.ɵɵelementStart(7, \"div\", 4);\n        i0.ɵɵelementStart(8, \"div\", 5);\n        i0.ɵɵelementStart(9, \"div\", 6);\n        i0.ɵɵelementStart(10, \"div\", 7);\n        i0.ɵɵelementStart(11, \"form\", 8);\n        i0.ɵɵelementStart(12, \"div\", 9);\n        i0.ɵɵelementStart(13, \"span\", 10);\n        i0.ɵɵtext(14, \" Barcode \\u0E04\\u0E34\\u0E27\\u0E2D\\u0E49\\u0E2D\\u0E22\\u0E17\\u0E32\\u0E07\\u0E44\\u0E01\\u0E25 \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"input\", 11);\n        i0.ɵɵlistener(\"ngModelChange\", function FardashboardComponent_Template_input_ngModelChange_15_listener($event) {\n          return ctx.barcode = $event;\n        })(\"change\", function FardashboardComponent_Template_input_change_15_listener() {\n          return ctx.Loadqonline(ctx.barcode);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(16, \"div\", 9);\n        i0.ɵɵelementStart(17, \"div\", 9);\n        i0.ɵɵelementStart(18, \"span\", 12);\n        i0.ɵɵtext(19, \" 1.\\u0E42\\u0E04\\u0E27\\u0E15\\u0E49\\u0E32\\u0E0A\\u0E32\\u0E27\\u0E44\\u0E23\\u0E48 : \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(20, \"input\", 13);\n        i0.ɵɵelementStart(21, \"datalist\", 14);\n        i0.ɵɵtemplate(22, FardashboardComponent_option_22_Template, 2, 2, \"option\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"div\", 9);\n        i0.ɵɵelementStart(24, \"span\", 12);\n        i0.ɵɵtext(25, \" 2.\\u0E17\\u0E30\\u0E40\\u0E1A\\u0E35\\u0E22\\u0E19\\u0E23\\u0E16 : \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(26, \"input\", 16);\n        i0.ɵɵelementStart(27, \"datalist\", 17);\n        i0.ɵɵtemplate(28, FardashboardComponent_option_28_Template, 2, 2, \"option\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(29, \"div\", 9);\n        i0.ɵɵelementStart(30, \"button\", 18);\n        i0.ɵɵlistener(\"click\", function FardashboardComponent_Template_button_click_30_listener() {\n          return ctx.UpdateQueue();\n        });\n        i0.ɵɵtext(31, \"\\u0E1A\\u0E31\\u0E19\\u0E17\\u0E36\\u0E01\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"div\", 6);\n        i0.ɵɵelementStart(33, \"div\", 7);\n        i0.ɵɵtemplate(34, FardashboardComponent_table_34_Template, 15, 3, \"table\", 19);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(35, \"app-footer\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"div\", 20);\n        i0.ɵɵelementStart(37, \"div\", 21);\n        i0.ɵɵelementStart(38, \"div\", 22);\n        i0.ɵɵelementStart(39, \"div\", 23);\n        i0.ɵɵelementStart(40, \"h5\", 24);\n        i0.ɵɵtext(41, \"\\u0E25\\u0E33\\u0E14\\u0E31\\u0E1A\\u0E04\\u0E34\\u0E27\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(42, \"button\", 25);\n        i0.ɵɵelementStart(43, \"span\", 26);\n        i0.ɵɵtext(44, \"\\u00D7\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(45, \"div\", 27);\n        i0.ɵɵtext(46);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"div\", 28);\n        i0.ɵɵelementStart(48, \"button\", 29);\n        i0.ɵɵtext(49, \"Close\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"fullScreen\", false);\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"formGroup\", ctx.FormOne);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngModel\", ctx.barcode);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngForOf\", ctx.farmerzone21);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.truckdata);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.farqrdata);\n        i0.ɵɵadvance(12);\n        i0.ɵɵtextInterpolate1(\" \\u0E19\\u0E33\\u0E04\\u0E34\\u0E27\\u0E19\\u0E35\\u0E49\\u0E44\\u0E1B\\u0E40\\u0E02\\u0E35\\u0E22\\u0E19\\u0E1A\\u0E19\\u0E1A\\u0E31\\u0E15\\u0E23 : \", ctx.forwardqrun + 1, \" \");\n      }\n    },\n    directives: [i2.NgxSpinnerComponent, i4.SidebarComponent, i5.HeaderComponent, i6.ɵNgNoValidate, i6.NgControlStatusGroup, i6.FormGroupDirective, i6.DefaultValueAccessor, i6.NgControlStatus, i6.FormControlName, i7.NgForOf, i8.FooterComponent, i6.NgSelectOption, i6.ɵNgSelectMultipleOption],\n    styles: [\"\"]\n  });\n  return FardashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}