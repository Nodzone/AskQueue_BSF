{"ast":null,"code":"import { FormGroup, FormControl } from '@angular/forms';\nimport axios from 'axios';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/forms\";\nexport let LoginComponent = /*#__PURE__*/(() => {\n  class LoginComponent {\n    constructor(router) {\n      this.router = router; // ค้นหาา Ip Address\n\n      this.ipAddress = '';\n      this.getIP();\n      this.login = new FormGroup({\n        username: new FormControl(''),\n        password: new FormControl('')\n      });\n    }\n\n    ngOnInit() {}\n\n    Loaddata() {\n      var userinfor = document.getElementById('username').value; // console.log(userinfor);\n\n      let url = 'https://asia-southeast2-brr-farmluck.cloudfunctions.net/dbcps/get_users?username=' + userinfor;\n      axios.get(url).then(res => {\n        const data = res.data.recordset;\n        this.username = data[0].username;\n        this.password = data[0].password;\n        this.userlevel = data[0].userlevel;\n        console.log(data[0]);\n        localStorage.setItem('userdata', JSON.stringify(data));\n      }).catch(err => {\n        throw err;\n      });\n    }\n\n    goLogin() {\n      var _a, _b;\n\n      let user = (_a = this.login.get('username')) === null || _a === void 0 ? void 0 : _a.value;\n      let password = (_b = this.login.get('password')) === null || _b === void 0 ? void 0 : _b.value;\n      console.log(this.login.value);\n      localStorage.setItem('active', JSON.stringify(1));\n\n      if (user == null && password == null) {\n        alert('กรุณากรอกชื่อผู้ใช้งานและรหัสผ่าน');\n      } else if (user == null || user == '') {\n        alert('กรุณากรอกชื่อผู้ใช้งาน');\n      } else if (password == null || password == '') {\n        alert('กรุณากรอกรหัสผ่าน');\n      } else if (password !== this.password) {\n        alert(\"รหัสผ่าน ไม่ถูกต้อง!\");\n      } else if (this.userlevel == 71) {\n        this.gokeepdata();\n        this.router.navigateByUrl(\"/fardashboard\");\n      } else if (this.userlevel == 70) {\n        this.gokeepdata();\n        this.router.navigateByUrl(\"/maindashboard\");\n      }\n    }\n\n    getIP() {\n      // let url = \"http://api.ipify.org/?format=json\"; // ip only\n      let url2 = \"https://geolocation-db.com/json/\";\n      axios.get(url2).then(res => {\n        console.log(res.data);\n        this.ipAddress = res.data.IPv4;\n      }).catch(error => {\n        throw error;\n      });\n      let test = new Date();\n      let test2 = test.getFullYear() + \"-\" + (\"0\" + (test.getMonth() + 1)).slice(-2) + \"-\" + (\"0\" + test.getDate()).slice(-2) + \" \" + (\"0\" + test.getHours()).slice(-2) + \":\" + (\"0\" + test.getMinutes()).slice(-2) + \":\" + (\"0\" + test.getSeconds()).slice(-2);\n      this.dayonlogin = test2;\n    }\n\n    gokeepdata() {\n      var _a;\n\n      let user = (_a = this.login.get('username')) === null || _a === void 0 ? void 0 : _a.value;\n      let url = \"https://asia-southeast2-brr-farmluck.cloudfunctions.net/dbcps/insert_zonelogin?datelogin='\" + this.dayonlogin + \"'&supcode='\" + user + \"'&zoneip='\" + this.ipAddress + \"'&web=%27https://farmer-brr.web.app/%27\";\n      axios.post(url).then(res => {\n        console.log(res.data);\n      }).catch(err => {\n        throw err;\n      });\n    }\n\n    resetForm() {\n      this.login.reset();\n    }\n\n  }\n\n  LoginComponent.ɵfac = function LoginComponent_Factory(t) {\n    return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.Router));\n  };\n\n  LoginComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginComponent,\n    selectors: [[\"app-login\"]],\n    decls: 27,\n    vars: 1,\n    consts: [[1, \"col-lg-12\"], [1, \"card\", \"card-stats\"], [1, \"card-header\", \"card-header-success\"], [1, \"material-icons\"], [1, \"card-title\"], [1, \"card-category\", \"text-while\"], [1, \"card-body\"], [3, \"formGroup\"], [1, \"col-md-12\"], [1, \"form-group\"], [\"type\", \"text\", \"placeholder\", \"User Name\", \"formControlName\", \"username\", \"id\", \"username\", 1, \"form-control\", 3, \"change\"], [\"type\", \"password\", \"placeholder\", \"Password\", \"formControlName\", \"password\", 1, \"form-control\"], [\"password\", \"\"], [1, \"row\"], [1, \"btn\", \"btn-sm\", \"pull-left\", 3, \"click\"], [1, \"btn\", \"btn-primary\", \"pull-left\", 3, \"click\"], [1, \"btn\", \"btn-warn\", \"pull-right\", 3, \"click\"]],\n    template: function LoginComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r1 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"i\", 3);\n        i0.ɵɵtext(4, \"person\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"h4\", 4);\n        i0.ɵɵtext(6, \"\\u0E40\\u0E02\\u0E49\\u0E32\\u0E2A\\u0E39\\u0E48\\u0E23\\u0E30\\u0E1A\\u0E1A \\u0E08\\u0E31\\u0E14\\u0E01\\u0E32\\u0E23\\u0E04\\u0E34\\u0E27\\u0E2D\\u0E49\\u0E2D\\u0E22\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"p\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"div\", 6);\n        i0.ɵɵelementStart(9, \"form\", 7);\n        i0.ɵɵelementStart(10, \"div\", 8);\n        i0.ɵɵelementStart(11, \"div\", 9);\n        i0.ɵɵelementStart(12, \"input\", 10);\n        i0.ɵɵlistener(\"change\", function LoginComponent_Template_input_change_12_listener() {\n          return ctx.Loaddata();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"div\", 8);\n        i0.ɵɵelementStart(14, \"div\", 9);\n        i0.ɵɵelement(15, \"input\", 11, 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"div\", 13);\n        i0.ɵɵelementStart(18, \"div\", 8);\n        i0.ɵɵelementStart(19, \"button\", 14);\n        i0.ɵɵlistener(\"click\", function LoginComponent_Template_button_click_19_listener() {\n          i0.ɵɵrestoreView(_r1);\n\n          const _r0 = i0.ɵɵreference(16);\n\n          return _r0.type = _r0.type == \"password\" ? \"text\" : \"password\";\n        });\n        i0.ɵɵtext(20, \"\\u0E41\\u0E2A\\u0E14\\u0E07\\u0E23\\u0E2B\\u0E31\\u0E2A\\u0E1C\\u0E48\\u0E32\\u0E19\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"div\", 13);\n        i0.ɵɵelementStart(22, \"div\", 0);\n        i0.ɵɵelementStart(23, \"button\", 15);\n        i0.ɵɵlistener(\"click\", function LoginComponent_Template_button_click_23_listener() {\n          return ctx.goLogin();\n        });\n        i0.ɵɵtext(24, \"Login\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"button\", 16);\n        i0.ɵɵlistener(\"click\", function LoginComponent_Template_button_click_25_listener() {\n          return ctx.resetForm();\n        });\n        i0.ɵɵtext(26, \"Reset\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"formGroup\", ctx.login);\n      }\n    },\n    directives: [i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName],\n    styles: [\"\"]\n  });\n  return LoginComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}